로그관리 - winston
===============

winston - npm [링크](https://www.npmjs.com/package/winston)
---------------

```
npm i winston
```

### /src/config/logger.js 생성
```
const winston = require('winston');

const logger = winston.createLogger({
    transports: [new winston.transports.Console({})], 
});

module.exports = logger;
```

### app.js
```
const logger = require('./src/config/logger');
logger.log('info', 'Hello');
```

> 서버 실행 시   
> {"level":"info","message":"Hello"} 라고 찍히는걸 볼 수 있다.   
> logger.log('info', 'Hello'); 대신 아래와 같이 입력 가능
```
logger.info('Hello');
```

### 레벨 지정하기
```
const winston = require('winston');

const logger = winston.createLogger({
    transports: [
        new winston.transports.Console({
            level: 'error', 
        })
    ], 
});

module.exports = logger;
```
> error 레벨로 지정할 경우 app.js에서 logger.info를 써도 로그가 출력되지 않는다. error 레벨보다 낮기 때문   
```
const levels = {
  error: 0,
  warn: 1,
  info: 2,
  http: 3,
  verbose: 4,
  debug: 5,
  silly: 6
};
```
> 아래로 갈수록 레벨이 낮다고 생각하면 된다.

### simple format
```
const winston = require('winston');

const logger = winston.createLogger({
    transports: [
        new winston.transports.Console({
            level: 'info', 
            format: winston.format.simple(), 
        })
    ], 
});

module.exports = logger;
```
#### format 변경 전
```
{"level":"info","message":"Hello"}
서버 가동
```
#### format 변경 후
```
info: Hello
서버 가동
```

### 색깔 입히기
> winstom.format.combine() 함수 사용
```
new winston.transports.Console({
    level: 'info', 
    format: winston.format.combine(
        winston.format.colorize(), 
        winston.format.simple(), 
    )
})
```

#### json 형태 출력, 시간 출력 기능
```
format: winston.format.combine(
    // winston.format.colorize(), 
    winston.format.timestamp({
        format: 'YYYY-MM-DD HH:mm:dd'
    }), 
    winston.format.json(), 
)
```

### 중복되는 부분 정리
```
const { createLogger, transports, format } = require('winston');
const { combine, colorize, timestamp, json, simple } = format;

const logger = createLogger({
    transports: [
        new transports.Console({
            level: 'info', 
            format: combine(
                // colorize(), 
                timestamp({
                    format: 'YYYY-MM-DD HH:mm:dd'
                }), 
                json(), 
            )
        })
    ], 
});

module.exports = logger;
```

### printf를 이용해 원하는 문자열 출력
> combine 안의 마지막에 오는 파라미터가 출력 포맷을 결정짓기 때문에 다음과 같이 응용 가능
```
const printLogFormat = combine(
    timestamp({
        format: 'YYYY-MM-DD HH:mm:dd'
    }), 
    printf(({ timestamp, level, message }) => {
        return `${timestamp} ${level} : ${message}`;
    })
);
```

### label, colorize 적용한 정리된 코드
```
const { createLogger, transports, format } = require('winston');
const { combine, colorize, timestamp, json, simple, printf, label } = format;

const printFormat = printf(({ timestamp, label, level, message }) => {
    return `${timestamp} [${label}] ${level} : ${message}`;
});

const printLogFormat = combine(
    label({
        label: '백엔드맛보기'
    }), 
    colorize(), 
    timestamp({
        format: 'YYYY-MM-DD HH:mm:dd'
    }), 
    printFormat
);

const logger = createLogger({
    transports: [
        new transports.Console({
            level: 'info', 
            format: printLogFormat, 
        })
    ], 
});

module.exports = logger;
```
